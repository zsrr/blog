---
title: Java虚拟机大致结构
date: 2017-11-15 18:33:00
tags: [Java,JVM]
categories: Java

---
本篇记录Java虚拟机的大致布局，参照书籍[《Java虚拟机规范》](https://item.jd.com/11703581.html)。仅做个人学习笔记用。

<!--more-->

# 程序计数器
在传统的操作系统中，程序计数器(Program Counter)是包含当前正在执行指令地址的寄存器。在JVM当中，每一个线程都有自己的PC，如果这个方法不是本地方法，那么此PC就包含正在执行的字节码指令的地址。如果是本地方法，则PC寄存器的值为undefined。
# Java虚拟机栈
虚拟机栈也是线程私有的，是在方法调用时所用到的数据结构。方法的调用和完成对应着**栈帧**的入栈和出栈。一个栈帧存放的是方法对应的**局部变量表、操作数栈、动态链接**等信息。

Java虚拟机栈会遇到下面两种异常：

- StackOverflowError: 如果线程申请的栈的大小超出了JVM规定的最大栈大小，将会抛出此异常。
- OutOfMemoryError: 如果无法申请到足够多的内存，将会抛出此异常。

# 本地方法栈
顾名思义，本地方法栈只对应native方法。与虚拟机栈一样，会抛出StackOverflowError和OutOfMemoryError异常。
# Java堆
堆(Heap)是各个线程共享的内存区域，是类实例和数组对象分配内存的地方。

其所属的内容被自动内存管理系统所管理，根据所采用的策略来进行分配和回收。当堆中的内存用光并且无法进行扩展的时候，将会抛出OutOfMemoryError异常。
# 方法区
方法区存放着类的结构信息。根据规范，方法区可以不用实现垃圾回收。

方法区可以抛出OutOfMemoryError异常。
# 运行时常量池
运行时常量池属于方法区的部分。存放着两种常量：字面值常量和符号引用。符号引用要通过解析才可以变为直接引用，这里先不谈如何解析。

与常量池最相关的一个方法是String.intern()方法。intern()方法的含义为：当一个String实例str调用intern()方法时，Java查找常量池中是否有相同Unicode的字符串常量，如果有，则返回其的引用，如果没有，则在常量池中增加一个Unicode等于str的字符串并返回它的引用。注意是在常量池拷贝一份，而不是将str的地址放到常量池。

运行时常量池可以抛出OutOfMemoryError异常。
# 有关的设置参数
参见: [JVM参数设置、分析](http://www.cnblogs.com/redcreen/archive/2011/05/04/2037057.html)
